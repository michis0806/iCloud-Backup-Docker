version: "3.8"

services:
  icloud-backup:
    build: .
    container_name: icloud-backup
    restart: unless-stopped
    mem_limit: 512m
    # cpus: 1.0  # Requires kernel CFS scheduler support (not available on all Synology models)
    ports:
      - "${WEB_PORT:-8080}:8080"
    volumes:
      - ${BACKUP_PATH:-./backups}:/backups
      - ${CONFIG_PATH:-./config}:/config
      - ${ARCHIVE_PATH:-./archive}:/archive
      # Synology DSM notifications (uncomment on Synology NAS)
      # - /usr/syno/bin/synodsmnotify:/usr/local/bin/synodsmnotify:ro
      # - /usr/lib:/usr/syno/lib:ro
    environment:
      - TZ=${TZ:-Europe/Berlin}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DSM_NOTIFY=${DSM_NOTIFY:-false}
      # - AUTH_PASSWORD=mein-sicheres-passwort  # If not set, a random password is logged on startup
      # - SECRET_KEY=...  # Optional; falls back to AUTH_PASSWORD if not set
